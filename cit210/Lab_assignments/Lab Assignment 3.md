# Lab 3: Installing and Configuring Network Applications

[Canvas Link](https://canvas.csun.edu/courses/150468/assignments/1855195)

[PDF Download](https://canvas.csun.edu/courses/150468/files/24746401?wrap=1)

#### Table of contents
* [Deliverables](#deliverables)
* [Task 1](#task-1-install-configure-and-run-wireshark)
* [Task 2](#task-2-capturing-web-traffic-using-wireshark)
* [Task 3](#task-3-basic-apache-configuration)
    * [Exercise 1](#exercise-1-installation-and-basic-configuration-of-the-apache-web-server)
    * [Exercise 2](#exercise-2-locating-key-apache-files-and-folders)
    * [Exercise 3](#exercise-3-configure-and-run-apache-web-server)
* [Task 4](#task-4-install-configure-connect-ftp-server--record-traffic-using-wireshark)

## Deliverables

For this Lab you will be turning in a Word doc that contains the following:

**Task 1**
1. Screenshot of Wireshark in action.

**Task 2**
1. Screenshot of Wireshark data from an HTTP page.
1. Answers to the following questions: 
    - Which version of the HTTP protocol is used in these transactions? 
    - What is the domain name of the Web server? 
    - What browser and version does the client use in this capture? 
    - What software and version is running on the Web server? 
    - What other documents/files did the client request during this transaction? 

**Task 3**
1. Screenshots of the following:
    - Whether or not Apache is installed on your Linux VM natively.
    - Successful instalation of httpd & httpd-manual.
1. What commands are used to complete the following tasks:
    - Check if Apache is installed.
    - Install httpd & httpd-manual.
1. The locations of the following files:
    - Apache Reference Manual
    - Apache configuration file
    - Document root
    - Error documents directory
    - Log files
    - The Apache daemon (executable)
1. A screenshot showing that Apache is running on port 80.
1. The answers to the following questions:
    - What special user and group name does Linux use for running apache?
    - How can you test your Apache installation?
    - What are the log files generated by Apache?
    - What is Virtual Hosting?
    - How to secure Website hosted on Apache Web Server?

**Task 4**
1. A screenshot of the packets sent during FTP between the FTP server and FileZilla client. 
1. Which ftp ports were used for communication.

> [!WARNING]
> This assignment requires use of the Windows GUI. If you have the CLI-only version of Windows Server 2022, these instructions will not be able to fully help you.

## Task 1: Install Configure and Run Wireshark

Wireshark is a valuable tool commonly used by IT professionals to monitor network traffic. It can be used by network administrators to troubleshoot issues or bad actors to steal unencrypted information. In this task we will be installing & configuring wireshark and seeing it's capabilities.

### Installing Wireshark

Open your Linux VM and launch the terminal. Run the following commands to install Wireshark:
```bash
sudo apt update
sudo apt upgrade -y
sudo apt install wireshark -y
```
Once you run the last command, your terminal should automatically open a prompt that ask you if non-superusers should be able to capture packets. Make sure NO is selected and press enter. You should now be able to launch wireshark by typing in `sudo wireshark`.

If you run into the error `couldn't run /usr/bin/dumpcap in child process: Permission Denied`, check in details. Otherwise, continue to Capturing Traffic. 

<details>

On your Linux Terminal, type in the following bash commands:
``` bash
sudo dpkg-reconfigure wireshark-common
```
This time, select YES. This creates a special wireshark group. Now that the group is created, then you need to add your user account to the group. Type in the following command:
```bash
sudo adduser $USER wireshark
```
Restart your VM and launch wireshark through the terminal.
</details>

### Capturing Traffic

Follow these steps to start capturing network traffic.
1. Open Firefox or a similar web browser to verify internet connectivity
1. On Wireshark, select Capture > Options
1. Uncheck "Enable promiscious mode on all interfaces" and then select "enp0s3"
1. Click start
1. Switch back to Firefox and go to a website, like the Wikepedia article for Wireshark.
1. Once the webpage finishes loading, switch back to Wireshark and stop capturing. Your screen should something like this:

![Wireshark Traffic Example Task 1](/Pictures/Task1_Wireshark.png)

Now you have successfully completed installing & configuring wireshark!

## Task 2: Capturing Web Traffic Using Wireshark

1. Open wireshark and start capturing traffic like you did in the last task.
1. Open Firefox and go to neverssl.com
1. Once the website finishes loading, go back to Wireshark and stop capturing. 

> [!TIP]
> Make sure you launch Firefox before you start recording to limit the amount of web traffic that gets captured.

4. Once you stop capturing packets, scroll to the top of the list and look for the first HTTP frame. You will find the information regarding the HTTP version used, the browser the user accessed the site from.
1. At the bottom of the HTTP field in the frame, it should list which frame contains the response. That frame contains information about the applications running on the server.

## Task 3: Basic Apache Configuration

The Apache HTTP Server (“httpd”) is the most commonly used web server on Linux systems. It is used to host most of the smaller-medium sized websites on the internet (including neverssl.com).

### Exercise 1: Installation and Basic Configuration of the Apache Web Server

Before we install Apache, we should first make sure it is not already installed. To do that, run the following bash command:
```bash
apt-cache policy apache2
```
You should see in the text that was written back to the CLI `Installed: (none)`. That means that it is not installed. Which means it's time to install it. Run the following commands in your terminal:
```bash
sudo apt update
sudo apt upgrade -y # you already want to make sure you update/upgrade before installing anything!
sudo apt install apache2 -y
```
You can now run the `apt-cache...` command again to verify that it was successfully installed.

### Exercise 2: Locating Key Apache Files and Folders

Here are the locations of the key files & folders for the Apache service.

#### Apache Reference Manual

`/use/share/doc/apache2/README.Debian.gz`

#### Apache Configuration File

`/etc/apache2/apache2.conf`

#### Document Root

`/usr/share/apache2/build.`

#### Error Documents Directory

`/usr/share/apache2/error/.`

#### Log files

`/var/log/apache2/.`

#### The Apache daemon (executable)
`/usr/sbin/apache2`

### Exercise 3: Configure and Run Apache Web Server

To start the apache web server, run the following bash commands:
```bash
sudo service apache2 start
sudo service apache2 status
```
The output should say apache2.service is active. You will now further verify that it is working properly by checking the network activity using `netstat`. Run the following command to check for all network activity of the apache web server:
```bash
sudo netstat -npl | grep apache
```
Your output should look something like this:
```
tcp6    0       0 :::80           :::*               LISTEN
776/apache2
```

## Task 4: Install, Configure Connect FTP Server & Record Traffic Using Wireshark

FileZilla is an open source FTP software that supports both Linux & Windows. It works through a server-client system, where there is a server that hosts the files and a client that can retrieve them.

**Table of Contents**
- [Creating a New Windows User](#creating-a-new-windows-user)
- [Installing & Configuring the FileZilla Server](#installing--configuring-the-filezilla-server)
- [Configuring the Windows Firewall & VM Network Settings](#configuring-the-windows-firewall--vm-network-settings)
- [Installing & Configuring the Filezilla Client](#installing--configuring-the-filezilla-client)

### Creating a New Windows User

In order to use FileZilla, you need to first create a user account that the Linux user will log in with. Open up your Windows VM and follow the below steps:
1. Open Settings > Accounts > Other users > "Add someone else to this PC"
1. Select Users from the left hand menu
1. Select Actions > New User
1. Select a username that is the same as your Linux username ***but a password that is different***.
1. Uncheck "User must change password at next login" and check "Password never expires"
1. Select "Create" and then close all open windows 

### Installing & Configuring the FileZilla Server

Our first step for configuring FileZilla is going to be installing the FileZila server. To do this follow the below steps:
1. Download FileZilla for server by following the link [here](https://filezilla-project.org/download.php?type=server)
1. Launch the installer once it's downloaded
1. Make sure "full" is selected for the installation type and select next > next > next > next
1. When it asks for you to set the administration password, choose something easy to remeber
1. Click next > install
1. Click okay, then copy the SHA256 fingerprint to your clipboard, then select close
1. Open notepad and paste the fingerprint there
1. Go to the FileZilla administration interface and select "connect to server"
1. Enter the password you had entered before and connect
1. Click yes when it asks you about the fingerprint

Now that you have the server installed, you need to configure the user account. Follow the below steps:
1. Press Ctrl + F to open the server settings
1. Select Users > Add
1. Type out the same username you just created then press enter
1. Make sure "User is enabled" is selected and that Authentication is set to "Use system credentials to log in"
1. In mount points, select add. For the Virtual Path, put `/`. In the Native Path, put `C:\Users\<username>`
1. Click Apply, then Okay

Now you have the FileZilla server configured. But before you can connect to it, you need to configure the Windows Firewall to allow traffic from the app.

### Configuring the Windows Firewall & VM Network Settings

1. Open the search bar and type in "Firewall" and select the top result
1. Select "Allow an app through firewall" > "Allow another app"
1. For the path put `C:\Program Files\Filezilla Server\filezilla-server.exe`
1. Select add, then okay

Now that the firewall is configured, you need to change the VM network settings in order to allow the FileZilla client & server to communicate. Go to VirtualBox and click on settings for **both** the Linux and Windows machines. In network settings, change the adapter from NAT Network to Bridged Connector. Have each VM ping each other to verify connectivity.

### Installing & Configuring the FileZilla Client

Switch back to your Linux VM and run the below terminal commands:
```bash
sudo apt update
sudo apt upgrade -y
sudo apt install filezilla -y
```
Once that finishes installing you can verify the installation by running the command `filezilla --version`. Find the application in the applications menu and launch it. 

Once FileZilla is launched, you should see a bar along the top for quick connect. Enter the below information and then press "Quickconnect":
- Host: Windows VM IP address
- Username/Password: the account credentials you created at the start of this task
- Port: Leave this blank

If you have followed these instructions correctly it should say that you have successfully connected to the server.

>[!NOTE]
> You may encounter an error that says "Failed to retrieve directory listing". Ignore it.

In order to complete the task, you need to upload a file to the remote site. You can either create a file or upload an existing one, it doesn't matter. If it uploads successfully, then congratulations!

## Task 5: Install Configure and Transfer Files from tftp Server to tftp Client using tftp64 Application 

### Enable & Configure tftp on your Windows Server

Windows comes with tftp preinstalled, you simply have to enable it.
1. Open Control Panel & go to programs > "Turn Windows features on or off". It should open Server Manager and bring up the "Add Roles and Features Wizard"
1. Make sure "Role-Based or..." is select and then click next
1. Select your machine from the server pool and click next again
1. Don't change anything on Server Roles and click next
1. In features, scroll down and select "tftp client", then next > finish > close

Now that tftp is configured, you need to configure the Window firewall to allow tftp traffic.
1. Open the search bar and type in "Firewall" and select the top result
1. Select "Allow an app through firewall" > "Allow another app"
1. For the path put `C:\Windows\System32\TFTP.EXE`
1. Select add, then okay

### Install tftp on your Linux Machine

To install tftp, switch back to your Linux machine and enter the following bash commands:
```bash
sudo apt update
sudo apt upgrade -y
sudo apt install atftpd -y
atfpd --daemon
-$ps -ef | grep atftpd # to check that it's installed
```

Now that tftp is installed on both your Windows & Linux machines, you should test it by creating a .txt document on your Windows Server desktop and entering the following powershell command:
```powershell
tftp <Linux VM IP> PUT C:\Users\<username>\Desktop\<filename>
```
And the following bash command
```bash
ls /srv/tftp
```

### Monitoring tftp traffic

> [!WARNING]
> This section is still-in progress! Come back later!

<!-- TODO: Complete Section -->
